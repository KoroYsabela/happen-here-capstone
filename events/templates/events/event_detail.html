{% extends "base.html" %}
{% load static %}
{% load crispy_forms_tags %}
{% block content %}


<div class="masthead">
    <div class="container">
        <div class="row g-0">
            <div class="col-12 col-md-6 masthead-text mt-1 order-1 order-md-1">
                <!-- Event title goes in these h1 tags -->
                <h1 class="event-title">{{ event.title }}</h1>
                <h5>{{event.date}}</h5>
                <!-- Event host -->
                <p class="event-subtitle">Hosted by {{ event.host }}</p>
                <!-- Capacity left -->
                {% if event.capacity >  0 %}
                <p class="event-subtitle"><strong>Spaces left: </strong>{{ event.capacity}}</p>
                    <!-- Booking button -->
                    {% if user.is_authenticated %}
                    <form action="{% url 'book_event' event.slug %}" method="post">
                        {% csrf_token %}
                        <button id="bookingbtn" type="submit" class="btn btn-signup"
                        >Book</button>
                    </form>
                    {% else %}
                        <p class="event-subtitle"><a href="{% url 'account_login' %}">Log in</a> to book</p>
                    {% endif %}
                {% else %}
                <p class="event-subtitle">This event is fully booked!</p>
                {% endif %}
                <!-- Edit event if user is host -->
                {% if user.is_authenticated and event.host == user %}
                    <button 
                    class="btn btn-outline-secondary edit-btn" 
                    data-bs-toggle="modal" 
                    data-bs-target="#editEventFormModal"
                    data-title="{{ event.title }}"
                    data-date="{{ event.date|date:'Y-m-d\\TH:i' }}"
                    data-capacity="{{ event.capacity }}"
                    data-location="{{ event.location }}"
                    data-description="{{ event.description|escapejs }}"
                    data-slug="{{ event.slug }}"
                    data-status="{{ event.status }}"
                    >
                    Edit
                    </button>
                {% endif %}                             
            </div>
            <div class="col-12 col-md-6 masthead-image mt-3 order-2 order-md-2">
                <div class="image-container">
                    {% if "placeholder" in event.featured_image.url %}
                    <img class="img-fluid w-100" src="{% static 'images/event_default.jpg' %}"
                    alt="placeholder image">
                    {% else %}
                    <img class="img-fluid w-100" src=" {{ event.featured_image.url }}" alt="{{ event.title }}">
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>

<div class="container">
    <div class="row">
        <div class="col card mb-4  mt-3 left  top">
            <div class="card-body">
                <!-- The post content goes inside the card-text. -->
                <!-- Use the | safe filter inside the template tags -->
                <h2>
                    {{ coder }}
                </h2> 
                <article class="card-text">
                    {{ event.description | safe }}
                </article>
            </div>
        </div>
    </div>
</div>

<!-- Edit event modal -->
<div class="modal fade" id="editEventFormModal" tabindex="-1" role="dialog" aria-labelledby="edit-event-modal-title" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
    <form method="POST" enctype="multipart/form-data" action="{% url 'edit_event' event.slug %}">
        <input type="hidden" name="event_slug" id="eventSlugInput">                   
        <div class="modal-header">
          <h5 class="modal-title" id="edit-event-modal-title">Editing: {{ event.title }}</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          {# Render the edit form with crispy so widgets and classes are output properly #}
          {{ edit_form | crispy }}
          {{ edit_form.media }} 
          {% csrf_token %} 
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="submit" name="save_draft" class="btn btn-outline-warning d-none" id="saveDraftBtn">Save as Draft</button>
          <button type="submit" name="publish" class="btn btn-success">Publish</button>
        </div>
      </form>
    </div>
  </div>
</div>


<!-- event_detail.html content ends here -->
{% endblock %}

{% block extras %}
<!-- Scripts 
<script src="{% static 'js/eventsHome.js' %}"></script>
--> 
<!-- Scripts --> 
<script src="{% static 'js/myevents.js' %}"></script>
{% if show_edit_modal %}
<script>
document.addEventListener('DOMContentLoaded', function () {
    const modalEl = document.getElementById('editEventFormModal');
    if (modalEl && typeof bootstrap !== 'undefined') {
        const modal = new bootstrap.Modal(modalEl);
        modal.show();
    }
});
</script>
{% endif %}
{% endblock %}